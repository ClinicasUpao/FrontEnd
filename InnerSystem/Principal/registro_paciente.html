<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Registro de Paciente</title>
     <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
     <!-- Google Fonts -->
     <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
     <link href="styles-register-v2.css" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
     <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
     <!-- Custom Styles -->
  </head>
  <body>
    <div class="container">
        <a href="registro.html" class="back-button">
            <span class="icono_flecha"> &lt; </span> 
        </a>
    <div class="titulo-container mt-3 d-flex align-items-center justify-content-between">
        <h2 class="titulo_registro">Nuevo Paciente</h2>
        <div class="history-button-container">
            <a href="historia.html" class="history-button">¿Tienes ya una historia con nosotros?</a>
        </div>
    </div>
    <div class="informacion-personal-title">
        Información Personal
    </div>
    
            <form id="registroPacienteForm" onsubmit="registrarPaciente(event)">
           
<div class="form-row">
    <div class="form-group col-md-6 d-flex align-items-center"> 
        <label for="tipoDocumento" class="mr-2">Tipo de Documento:</label> 
        <select class="form-control" id="tipoDocumento" onchange="validarDocumento()" required>
            <option value="">Seleccionar</option>
            <option value="DNI">DNI</option>
            <option value="Carnet de Extranjería">Carnet de Extranjería</option>
            <option value="Pasaporte">Pasaporte</option>
        </select>
        <div class="invalid-feedback">
            Por favor, selecciona tu tipo de documento.
        </div>
    </div>
    <div class="form-group col-md-6 d-flex align-items-center"> 
        <label for="documentoIdentidad" class="mr-2">Documento de Identidad:</label> 
        <input type="text" class="form-control" id="documentoIdentidad" placeholder="Documento de Identidad" required>
        <div class="invalid-feedback" id="documentoIdentidadFeedback">
            Por favor, ingresa tu documento de identidad.
        </div>
    </div>
</div>
                <!-- Nombre y Apellido -->
                <div class="form-row">
                    <div class="form-group col-md-6 d-flex align-items-center">
                        <label for="nombre" class="mr-2">Nombres</label>
                        <input type="text" class="form-control" id="nombre" placeholder="Nombre" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa tu nombre.
                        </div>
                    </div>
                    <div class="form-group col-md-6 d-flex align-items-center">
                        <label for="apellido" class="mr-2">Apellidos</label>
                        <input type="text" class="form-control" id="apellido" placeholder="Apellido" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa tu apellido.
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-5 d-flex align-items-center">
                        <label for="genero" class="mr-2">Género</label>
                        <select class="form-control" id="genero" required>
                            <option value="">Seleccionar</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                        </select>
                        <div class="invalid-feedback">
                            Por favor, selecciona tu género.
                        </div>
                    </div>
                    <div class="form-group col-md-7 d-flex align-items-center">
                        <label for="paisOrigen" class="mr-2">País de Origen</label>
                        <select class="form-control" id="paisOrigen" required>
                            <option value="">Selecciona un país</option>
                            <option value="Afganistán">Afganistán</option>
                            <option value="Alemania">Alemania</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Australia">Australia</option>
                            <option value="Brasil">Brasil</option>
                            <option value="Canadá">Canadá</option>
                            <option value="Chile">Chile</option>
                            <option value="China">China</option>
                            <option value="Colombia">Colombia</option>
                            <option value="Corea del Sur">Corea del Sur</option>
                            <option value="Costa Rica">Costa Rica</option>
                            <option value="Cuba">Cuba</option>
                            <option value="Dinamarca">Dinamarca</option>
                            <option value="Ecuador">Ecuador</option>
                            <option value="Egipto">Egipto</option>
                            <option value="El Salvador">El Salvador</option>
                            <option value="Emiratos Árabes Unidos">Emiratos Árabes Unidos</option>
                            <option value="España">España</option>
                            <option value="Estados Unidos">Estados Unidos</option>
                            <option value="Filipinas">Filipinas</option>
                            <option value="Francia">Francia</option>
                            <option value="Guatemala">Guatemala</option>
                            <option value="Honduras">Honduras</option>
                            <option value="India">India</option>
                            <option value="Indonesia">Indonesia</option>
                            <option value="Irán">Irán</option>
                            <option value="Irlanda">Irlanda</option>
                            <option value="Israel">Israel</option>
                            <option value="Italia">Italia</option>
                            <option value="Japón">Japón</option>
                            <option value="Kenia">Kenia</option>
                            <option value="México">México</option>
                            <option value="Nicaragua">Nicaragua</option>
                            <option value="Nigeria">Nigeria</option>
                            <option value="Noruega">Noruega</option>
                            <option value="Nueva Zelanda">Nueva Zelanda</option>
                            <option value="Países Bajos">Países Bajos</option>
                            <option value="Panamá">Panamá</option>
                            <option value="Paraguay">Paraguay</option>
                            <option value="Perú">Perú</option>
                            <option value="Polonia">Polonia</option>
                            <option value="Portugal">Portugal</option>
                            <option value="Reino Unido">Reino Unido</option>
                            <option value="República Checa">República Checa</option>
                            <option value="República Dominicana">República Dominicana</option>
                            <option value="Rusia">Rusia</option>
                            <option value="Sudáfrica">Sudáfrica</option>
                            <option value="Suecia">Suecia</option>
                            <option value="Suiza">Suiza</option>
                            <option value="Turquía">Turquía</option>
                            <option value="Uruguay">Uruguay</option>
                            <option value="Venezuela">Venezuela</option>
                            <option value="Vietnam">Vietnam</option>
                        </select>
                        <div class="invalid-feedback">Por favor, selecciona tu país de origen.</div>
                    </div>
                    
                    
                </div>

                <!-- Email y Contraseña -->
                <div class="form-row">
                    <div class="form-group col-md-6 d-flex align-items-center">
                        <label for="email" class="mr-2">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="Email" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa un email válido.
                        </div>
                    </div>
                    <div class="form-group col-md-6 d-flex align-items-center">
                        <label for="contrasena" class="mr-2">Contraseña</label>
                        <input type="password" class="form-control" id="contrasena" placeholder="Contraseña" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa una contraseña.
                        </div>
                    </div>
                </div>

                <div class="form-row align-items-center">
                    <div class="form-group col-md-4 d-flex align-items-center">
                        <label for="fechaNacimiento">Fecha de Nacimiento</label>
                    </div>
                    <div class="form-group col-md-3 mb-0">
                        <select class="form-control" id="diaNacimiento" required>
                            <option value="">Día</option>
                            <script>
                                for (let i = 1; i <= 31; i++) {
                                    document.write(`<option value="${i}">${i}</option>`);
                                }
                            </script>
                        </select>
                    </div>
                    <div class="form-group col-md-3 mb-0">
                        <select class="form-control" id="mesNacimiento" required>
                            <option value="">Mes</option>
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                    <div class="form-group col-md-3 mb-0">
                        <select class="form-control" id="anioNacimiento" required>
                            <option value="">Año</option>
                            <script>
                                for (let i = 2024; i >= 1900; i--) {
                                    document.write(`<option value="${i}">${i}</option>`);
                                }
                            </script>
                        </select>
                    </div>
                    <div class="form-group col-md-3 d-flex align-items-center mb-0">
                        <label for="edad" class="mr-1">Edad</label>
                        <input type="number" class="form-control" id="edad" placeholder="00" required readonly>
                    </div>
                </div>
                
                <div class="invalid-feedback" id="fechaFeedback">
                    Por favor, completa la fecha de nacimiento.
                </div>
                
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <div class="text_informacion">
                            Información de Contacto
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group col-md-7 d-flex align-items-center">
                        <label for="departamento" class="mr-2">Departamento</label>
                        <select class="form-control" id="departamento" required>
                            <option value="">Selecciona un departamento</option>
                            <option value="Amazonas">Amazonas</option>
                            <option value="Áncash">Áncash</option>
                            <option value="Apurímac">Apurímac</option>
                            <option value="Arequipa">Arequipa</option>
                            <option value="Ayacucho">Ayacucho</option>
                            <option value="Cajamarca">Cajamarca</option>
                            <option value="Callao">Callao</option>
                            <option value="Cusco">Cusco</option>
                            <option value="Huancavelica">Huancavelica</option>
                            <option value="Huánuco">Huánuco</option>
                            <option value="Ica">Ica</option>
                            <option value="Junín">Junín</option>
                            <option value="La Libertad">La Libertad</option>
                            <option value="Lambayeque">Lambayeque</option>
                            <option value="Lima">Lima</option>
                            <option value="Loreto">Loreto</option>
                            <option value="Madre de Dios">Madre de Dios</option>
                            <option value="Moquegua">Moquegua</option>
                            <option value="Pasco">Pasco</option>
                            <option value="Piura">Piura</option>
                            <option value="Puno">Puno</option>
                            <option value="San Martín">San Martín</option>
                            <option value="Tacna">Tacna</option>
                            <option value="Tumbes">Tumbes</option>
                            <option value="Ucayali">Ucayali</option>
                        </select>
                        <div class="invalid-feedback">Por favor, ingresa tu departamento.</div>
                    </div>
                    
                    <div class="form-group col-md-5 d-flex align-items-center">
                        <label for="distrito" class="mr-2">Distrito</label>
                        <select class="form-control" id="distrito" required>
                            <option value="">Selecciona un distrito</option>
                            <option value="Ate">Ate</option>
                            <option value="Barranco">Barranco</option>
                            <option value="Breña">Breña</option>
                            <option value="Carabayllo">Carabayllo</option>
                            <option value="Cercado de Lima">Cercado de Lima</option>
                            <option value="Chaclacayo">Chaclacayo</option>
                            <option value="Chorrillos">Chorrillos</option>
                            <option value="Cieneguilla">Cieneguilla</option>
                            <option value="Comas">Comas</option>
                            <option value="El Agustino">El Agustino</option>
                            <option value="Independencia">Independencia</option>
                            <option value="Jesus María">Jesus María</option>
                            <option value="La Molina">La Molina</option>
                            <option value="La Victoria">La Victoria</option>
                            <option value="Lince">Lince</option>
                            <option value="Magdalena del Mar">Magdalena del Mar</option>
                            <option value="Miraflores">Miraflores</option>
                            <option value="Pueblo Libre">Pueblo Libre</option>
                            <option value="Puente Piedra">Puente Piedra</option>
                            <option value="San Bartolo">San Bartolo</option>
                            <option value="San Borja">San Borja</option>
                            <option value="San Isidro">San Isidro</option>
                            <option value="San Juan de Lurigancho">San Juan de Lurigancho</option>
                            <option value="San Juan de Miraflores">San Juan de Miraflores</option>
                            <option value="San Luis">San Luis</option>
                            <option value="San Martín de Porres">San Martín de Porres</option>
                            <option value="San Miguel">San Miguel</option>
                            <option value="Santa Anita">Santa Anita</option>
                            <option value="Santa María del Mar">Santa María del Mar</option>
                            <option value="Santiago de Surco">Santiago de Surco</option>
                            <option value="Surquillo">Surquillo</option>
                            <option value="Ventanilla">Ventanilla</option>
                            <option value="Villa El Salvador">Villa El Salvador</option>
                            <option value="Villa María del Triunfo">Villa María del Triunfo</option>
                            <option value="Lima">Lima</option>
                            <option value="Arequipa">Arequipa</option>
                            <option value="Trujillo">Trujillo</option>
                            <option value="Piura">Piura</option>
                            <option value="Cusco">Cusco</option>
                            <option value="Chiclayo">Chiclayo</option>
                            <option value="Ica">Ica</option>
                            <option value="Puno">Puno</option>
                            <option value="Tacna">Tacna</option>
                            <option value="Chimbote">Chimbote</option>
                            <option value="Huancayo">Huancayo</option>
                            <option value="Juliaca">Juliaca</option>
                            <option value="Huaraz">Huaraz</option>
                            <option value="Ayacucho">Ayacucho</option>
                            <option value="Huancavelica">Huancavelica</option>
                            <option value="Junín">Junín</option>
                            <option value="Lambayeque">Lambayeque</option>
                            <option value="Loreto">Loreto</option>
                            <option value="Madre de Dios">Madre de Dios</option>
                            <option value="Moquegua">Moquegua</option>
                            <option value="Pasco">Pasco</option>
                            <option value="Piura">Piura</option>
                            <option value="Tumbes">Tumbes</option>
                            <option value="Ucayali">Ucayali</option>
                            <option value="Junín">Junín</option>
                            <option value="San Martín">San Martín</option>
                            <option value="Ayacucho">Ayacucho</option>
                            <option value="Cajamarca">Cajamarca</option>
                            <option value="Apurímac">Apurímac</option>
                            <option value="Huánuco">Huánuco</option>
                            <option value="La Libertad">La Libertad</option>
                            <option value="Ica">Ica</option>
                            <option value="Lima">Lima</option>
                            <option value="Cusco">Cusco</option>
                            <option value="Arequipa">Arequipa</option>
                            <option value="Huaral">Huaral</option>
                            <option value="Sullana">Sullana</option>
                            <option value="Pucallpa">Pucallpa</option>
                            <option value="Moquegua">Moquegua</option>
                            <option value="Chincha">Chincha</option>
                            <option value="Huancayo">Huancayo</option>
                            <option value="Barranca">Barranca</option>
                            <option value="Andahuaylas">Andahuaylas</option>
                            <option value="Mollendo">Mollendo</option>
                            <option value="Cañete">Cañete</option>
                            <option value="Puno">Puno</option>
                            <option value="Iquitos">Iquitos</option>
                        </select>
                        <div class="invalid-feedback">Por favor, ingresa tu distrito.</div>
                    </div>
                    
                </div>
                <!-- Distrito y Dirección -->
                <div class="form-row">
                    <div class="form-group col-md-12 d-flex align-items-center">
                        <label for="direccion" class="mr-2">Dirección</label>
                        <input type="text" class="form-control" id="direccion" placeholder="Ex. Calle Los Médicos de Vanguardia - No. 1023" required>
                        <div class="invalid-feedback">
                            Por favor, ingresa tu dirección.
                        </div>
                    </div>
                </div>

               <div class="form-row">
                <div class="form-group col-md-6 d-flex align-items-center">
                    <label for="telefono" class="mr-2">Teléfono</label>
                    <input type="tel" class="form-control" id="telefono" placeholder="Número de Teléfono" required pattern="[0-9]{9}">
                    <div class="invalid-feedback">Por favor, ingresa un número de teléfono válido de 10 dígitos.</div>
                </div>
            </div>
                
                <div class="text-center">
                    <button id="submit" type="submit" class="btn btn-primary">Registrarse</button>
                </div>
            </form>
        </div>
    
        <script>
            function validarDocumento() {
                const tipoDocumento = document.getElementById('tipoDocumento').value;
                const documentoIdentidad = document.getElementById('documentoIdentidad');
                const feedback = document.getElementById('documentoIdentidadFeedback');
        
                if (tipoDocumento === 'DNI') {
                    documentoIdentidad.setAttribute('maxlength', '8');
                    documentoIdentidad.setAttribute('pattern', '\\d{8}');
                    documentoIdentidad.setAttribute('title', 'El DNI debe tener 8 dígitos numéricos.');
                    feedback.textContent = 'El DNI debe tener 8 dígitos numéricos.';
                } else if (tipoDocumento === 'Carnet de Extranjería') {
                    documentoIdentidad.setAttribute('maxlength', '9');
                    documentoIdentidad.setAttribute('pattern', '\\d{9}');
                    documentoIdentidad.setAttribute('title', 'El Carnet de Extranjería debe tener 9 dígitos numéricos.');
                    feedback.textContent = 'El Carnet de Extranjería debe tener 9 dígitos numéricos.';
                } else if (tipoDocumento === 'Pasaporte') {
                    documentoIdentidad.setAttribute('maxlength','15');
                    documentoIdentidad.setAttribute('pattern','\\d{15}');
                    documentoIdentidad.setAttribute('title', 'Ingrese un pasaporte válido.');
                    feedback.textContent = 'Ingrese un pasaporte válido.';
                } else {
                    documentoIdentidad.removeAttribute('maxlength');
                    documentoIdentidad.removeAttribute('pattern');
                    documentoIdentidad.setAttribute('title', 'Ingrese un documento de identidad válido.');
                    feedback.textContent = 'Por favor, ingresa tu documento de identidad.';
                }
            }
        
            document.getElementById('tipoDocumento').addEventListener('change', validarDocumento);
        
            (function () {
                'use strict';
                window.addEventListener('load', function () {
                    var forms = document.getElementsByClassName('needs-validation');
        
                    var validation = Array.prototype.filter.call(forms, function (form) {
                        form.addEventListener('submit', function (event) {
                            if (form.checkValidity() === false) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                            form.classList.add('was-validated');
                        }, false);
                    });
                }, false);
            })();
        
            function registrarPaciente(event) {
                event.preventDefault();
                const form = document.getElementById('registroPacienteForm');
        
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }
        
                // Obtener los valores del día, mes y año
                const dia = document.getElementById('diaNacimiento').value;
                const mes = document.getElementById('mesNacimiento').value;
                const anio = document.getElementById('anioNacimiento').value;
        
                // Validar que los tres campos de fecha estén completos
                if (!dia || !mes || !anio) {
                    alert('Por favor, completa la fecha de nacimiento.');
                    return;
                }
        
                // Crear la fecha de nacimiento en formato YYYY-MM-DD
                const fechaNacimiento = `${anio}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
        
                const data = {
                    nombre: document.getElementById('nombre').value,
                    apellido: document.getElementById('apellido').value,
                    email: document.getElementById('email').value,
                    contrasena: document.getElementById('contrasena').value,
                    fechaNacimiento: fechaNacimiento,  // Usamos la fecha calculada aquí
                    genero: document.getElementById('genero').value,
                    paisOrigen: document.getElementById('paisOrigen').value,
                    departamento: document.getElementById('departamento').value,
                    distrito: document.getElementById('distrito').value,
                    direccion: document.getElementById('direccion').value,
                    documentoIdentidad: document.getElementById('documentoIdentidad').value,
                    tipoDocumento: document.getElementById('tipoDocumento').value,
                    telefonoNumero: document.getElementById('telefono').value
                };
        
                fetch('http://localhost:8080/api/v1/auth/registro/paciente', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (response.ok) {
                        alert("Paciente registrado con éxito");
                        window.location.href = "login.html";  
                    } else {
                        return response.json().then(error => { throw new Error(error.message) });
                    }
                })
                .catch(error => {
                    alert("Error al registrar paciente: " + error.message);
                });
            }
        
            function calcularEdad() {
                const dia = document.getElementById("diaNacimiento").value;
                const mes = document.getElementById("mesNacimiento").value;
                const anio = document.getElementById("anioNacimiento").value;
        
                if (dia && mes && anio) {
                    const fechaNacimiento = new Date(anio, mes - 1, dia);
                    const hoy = new Date();
                    let edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
                    const m = hoy.getMonth() - fechaNacimiento.getMonth();
        
                    if (m < 0 || (m === 0 && hoy.getDate() < fechaNacimiento.getDate())) {
                        edad--;
                    }
        
                    document.getElementById("edad").value = edad;
                } else {
                    document.getElementById("edad").value = ''; 
                }
            }
        
            document.getElementById("diaNacimiento").addEventListener("change", calcularEdad);
            document.getElementById("mesNacimiento").addEventListener("change", calcularEdad);
            document.getElementById("anioNacimiento").addEventListener("change", calcularEdad);
        </script>
        
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>
